<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Post Organizer - Vue.js</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- QR code scanner library -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <!-- Supabase JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app">
        <!-- QR Modal -->
        <qr-modal 
            v-if="showQrModal" 
            @credentials-loaded="handleCredentialsLoaded">
        </qr-modal>

        <!-- Main App -->
        <div v-if="!showQrModal" class="max-w-4xl mx-auto p-4">
            <!-- Header -->
            <header class="flex flex-col sm:flex-row items-center justify-between mb-6">
                <h1 class="text-3xl font-bold mb-2 sm:mb-0">Instagram Post Organizer</h1>
                <div class="flex gap-2">
                    <button @click="openModal" class="btn primary">Add New Post</button>
                </div>
            </header>

            <!-- Posts Table -->
            <div class="overflow-x-auto bg-white rounded-lg shadow mb-8">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Post Description</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <!-- Empty State -->
                        <tr v-if="posts.length === 0">
                            <td colspan="5" class="empty-state">
                                <h3 class="text-lg font-semibold">No posts yet</h3>
                                <p>Click "Add New Post" to get started</p>
                            </td>
                        </tr>

                        <!-- Posts -->
                        <tr v-for="post in posts" :key="post.id">
                            <td class="px-4 py-2">{{ post.id }}</td>
                            <td class="px-4 py-2 post-images-cell">
                                <div v-if="post.images && post.images.length > 0" class="flex flex-wrap gap-1 items-center">
                                    <img 
                                        v-for="(image, index) in post.images.slice(0, 4)" 
                                        :key="index"
                                        :src="image" 
                                        :alt="`Image ${index + 1}`" 
                                        class="w-16 h-16 object-cover rounded border border-gray-200 cursor-pointer hover:opacity-80 transition-opacity"
                                        @click="openImageModal(post.images, index)">
                                    <div v-if="post.images.length > 4" class="ml-2 text-xs text-gray-500 font-semibold cursor-pointer hover:text-gray-700 transition-colors"
                                         @click="openImageModal(post.images, 4)">
                                        +{{ post.images.length - 4 }} more
                                    </div>
                                </div>
                                <span v-else class="text-gray-400">No images</span>
                            </td>
                            <td class="px-4 py-2 post-description" :title="post.description">{{ post.description }}</td>
                            <td class="px-4 py-2">
                                <span :class="`status-badge ${post.status}`">{{ post.status }}</span>
                            </td>
                            <td class="px-4 py-2 actions">
                                <div class="flex gap-2">
                                    <button @click="editPost(post)" class="inline-flex items-center gap-1 px-3 py-1 rounded bg-blue-500 hover:bg-blue-600 text-white text-xs font-semibold shadow transition" title="Edit">
                                        <svg xmlns='http://www.w3.org/2000/svg' class='h-4 w-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15.232 5.232l3.536 3.536M9 13l6.536-6.536a2 2 0 112.828 2.828L11.828 15.828a2 2 0 01-2.828 0L5 11.828a2 2 0 010-2.828L9 13z' /></svg>
                                        Edit
                                    </button>
                                    <button @click="toggleStatus(post)" :class="post.status === 'approved' ? 'bg-yellow-400 hover:bg-yellow-500 text-gray-900' : 'bg-green-500 hover:bg-green-600 text-white'" class="inline-flex items-center gap-1 px-3 py-1 rounded text-xs font-semibold shadow transition" :title="post.status === 'approved' ? 'Unapprove' : 'Approve'">
                                        <svg v-if="post.status === 'approved'" xmlns='http://www.w3.org/2000/svg' class='h-4 w-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12' /></svg>
                                        <svg v-else xmlns='http://www.w3.org/2000/svg' class='h-4 w-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7' /></svg>
                                        {{ post.status === 'approved' ? 'Unapprove' : 'Approve' }}
                                    </button>
                                    <button @click="deletePost(post.id)" class="inline-flex items-center gap-1 px-3 py-1 rounded bg-red-500 hover:bg-red-600 text-white text-xs font-semibold shadow transition" title="Delete">
                                        <svg xmlns='http://www.w3.org/2000/svg' class='h-4 w-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12' /></svg>
                                        Delete
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <!-- Pagination -->
                        <tr>
                            <td colspan="5" class="py-2 text-center">
                                <button @click="prevPage" :disabled="currentPage === 1" class="btn small">Prev</button>
                                <span class="mx-2">Page {{ currentPage }} of {{ maxPage }}</span>
                                <button @click="nextPage" :disabled="currentPage === maxPage" class="btn small">Next</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Image Modal -->
            <image-modal 
                v-if="showImageModal" 
                :images="modalImages"
                :current-index="modalCurrentIndex"
                @close="closeImageModal">
            </image-modal>

            <!-- Post Modal -->
            <post-modal 
                v-if="showModal" 
                :post="editingPost" 
                @close="closeModal" 
                @save="handleSavePost">
            </post-modal>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>